#!/bin/bash
set -e

cat >/etc/apt/apt.conf.d/99lean-apt.conf <<'EOF'
APT::Install-Recommends "0";
APT::Install-Suggests "0";
Acquire::Languages "none";
EOF

# aplicar
apt-get update

cat >/etc/dpkg/dpkg.cfg.d/01-nodoc <<'EOF'
# Documentação
path-exclude=/usr/share/doc/*
# Preserva os metadados legais obrigatórios
path-include=/usr/share/doc/*/copyright

# Manuais e afins
path-exclude=/usr/share/man/*
path-exclude=/usr/share/groff/*
path-exclude=/usr/share/info/*
path-exclude=/usr/share/lintian/*
path-exclude=/usr/share/linda/*

# Locales (arquivos de tradução)
path-exclude=/usr/share/locale/*
path-exclude=/usr/share/locale-langpack/*

# Mantém o alias de locale (evita alguns avisos)
path-include=/usr/share/locale/locale.alias
EOF

echo "[+] Setting up bridge server for BP19803 architecture"

# 1. Netplan Configuration
echo "[+] Creating Netplan bridge configuration"
cat <<EOF | sudo tee /etc/netplan/01-bridge.yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      dhcp4: no
      dhcp6: no
    eth1:
      dhcp4: no
      dhcp6: no
  bridges:
    br0:
      interfaces: [eth0, eth1]
      parameters:
        stp: false
        forward-delay: 0
      dhcp4: no
      dhcp6: no
      addresses:
        - 192.168.13.24/22
      routes:
        - to: 0.0.0.0/0
          via: 192.168.15.1
          metric: 100
      nameservers:
        addresses:
          - 127.0.0.1
EOF

echo "[+] Applying Netplan"
